---
title: "Project_DataExploration"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE) 
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


# Set Working Directory and Load Data 
```{r setup, include=FALSE}
# Set your working directory

setwd("/Users/rmlandman/Desktop/Data Analytics/Environmental_Data_Analytics_2020/Project/EDA_2020_Project")
getwd()

# Load your packages


library(plyr)
library(tidyverse)
library(ggplot2)
library(lubridate)
library(viridis)
library(RColorBrewer)
library(cowplot)
library(LAGOSNE)
library(sf)
library(maps)
library(gganimate)
library(sf)
library(ggmap)
library(here)
library(maps)

# Set your ggplot theme

mytheme <- theme_classic(base_size = 14) +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "top")

theme_set(mytheme)

# Load your datasets

EC_Flow.Nutrients_Wide <-
  read.csv("./Data/Processed/EC_Flow.Nutrients_Wide_Processed.csv")

Club.Gorman_Flow.Nutrients_Wide <-
  read.csv("./Data/Processed/ClubGorman_Flow.Nutrients_Wide_Processed.csv")

Club.Gorman_Flow_Long <- read.csv("./Data/Processed/ClubGorman_USGSDischarge_Long.csv")

class(Club.Gorman_Flow_Long$X_00060_00003)

Club.Gorman_Flow_Wide <- read.csv("./Data/Processed/ClubGorman_USGSDischarge_Wide.csv")

Club.Gorman_Flow.Nutrients_Long <-
  read.csv("./Data/Processed/ClubGorman_Flow.Nutrients_Long_Processed.csv")
```

# Format Dates
```{r}
Club.Gorman_Flow.Nutrients_Wide$Date <- 
  as.Date(Club.Gorman_Flow.Nutrients_Wide$Date, format = "%Y-%m-%d")
class(Club.Gorman_Flow.Nutrients_Wide$Date)

Club.Gorman_Flow_Wide$Date <- 
  as.Date(Club.Gorman_Flow_Wide$Date, format = "%Y-%m-%d")
class(Club.Gorman_Flow_Wide$Date)

Club.Gorman_Flow_Long$Date <- 
  as.Date(Club.Gorman_Flow_Long$Date, format = "%Y-%m-%d")
class(Club.Gorman_Flow_Long$Date)

EC_Flow.Nutrients_Wide$Date <- 
  as.Date(EC_Flow.Nutrients_Wide$Date, format = "%Y-%m-%d")
class(EC_Flow.Nutrients_Wide$Date)

```

#Format Site Number to Character
```{r}

Club.Gorman_Flow.Nutrients_Wide$site_no <- 
  as.character(Club.Gorman_Flow.Nutrients_Wide$site_no)
class(Club.Gorman_Flow.Nutrients_Wide$site_no)

Club.Gorman_Flow_Wide$site_no.x <- 
  as.character(Club.Gorman_Flow_Wide$site_no.x)
class(Club.Gorman_Flow_Wide$site_no.x)

Club.Gorman_Flow_Wide$site_no.y <- 
  as.character(Club.Gorman_Flow_Wide$site_no.y)
class(Club.Gorman_Flow_Wide$site_no.y)

Club.Gorman_Flow_Long$site_no <- 
  as.character(Club.Gorman_Flow_Long$site_no, format)
class(Club.Gorman_Flow_Long$site_no)

EC_Flow.Nutrients_Wide$site_no <- 
  as.character(EC_Flow.Nutrients_Wide$site_no)
class(EC_Flow.Nutrients_Wide$site_no)

EC_Flow.Nutrients_Wide$site_no.x <- 
  as.character(EC_Flow.Nutrients_Wide$site_no.x)
class(EC_Flow.Nutrients_Wide$site_no.x)

EC_Flow.Nutrients_Wide$site_no.y <- 
  as.character(EC_Flow.Nutrients_Wide$site_no.y)
class(EC_Flow.Nutrients_Wide$site_no.y)

```


# Find Start and End dates 
# find out the start and end dates of the dataset
```{r}
#Date range for flow 
interval(first(Club.Gorman_Flow_Long$Date), last(Club.Gorman_Flow_Long$Date))

```


# Get summaries 
NTL.PeterPaul.summaries <- 
  NTL.phys.nutrient.data.PeterPaul %>%
  filter(depth == 0) %>%
  group_by(lakename, month) %>%
  filter(!is.na(temperature_C) & !is.na(tn_ug) & !is.na(tp_ug)) %>%
  summarise(meantemp = mean(temperature_C), 
            sdtemp = sd(temperature_C), 
            meanTN = mean(tn_ug), 
            sdTN = sd(tn_ug), 
            meanTP = mean(tp_ug), 
            sdTP = sd(tp_ug))
# Flow Summaries             
```{r}
Club.Gorman_Flow_MonthSummary <- Club.Gorman_Flow_Long %>% 
  mutate(month = month(Date, label = TRUE)) %>% 
  group_by(site_no, month) %>% 
  filter(!is.na(Discharge)) %>% 
  summarise(meanDischarge = mean(Discharge),
            sdDischarge = sd(Discharge),
            minDischarge = min(Discharge),
            maxDischarge = max(Discharge))


Club.Gorman_Flow_YearSummary <- Club.Gorman_Flow_Long %>% 
  mutate(year = year(Date)) %>% 
  group_by(site_no, year) %>% 
  filter(!is.na(Discharge)) %>% 
  summarise(meanDischarge = mean(Discharge),
            sdDischarge = sd(Discharge),
            minDischarge = min(Discharge),
            maxDischarge = max(Discharge))
```
# Nutrient Summaries


# Flow 
```{r}
Dischargeplot <-
  ggplot(Club.Gorman_Flow_Long, aes(y = Discharge)) +
  geom_boxplot()
print(Dischargeplot)

mean(Club.Gorman_Flow_Long$Discharge, na.rm=TRUE)
min(Club.Gorman_Flow_Long$Discharge, na.rm=TRUE)
max(Club.Gorman_Flow_Long$Discharge, na.rm=TRUE)
sd(Club.Gorman_Flow_Long$Discharge, na.rm=TRUE)
IQR(Club.Gorman_Flow_Long$Discharge, na.rm=TRUE)

# Mean Annual Discharge 
MeanDischargeplot <-
  ggplot(Club.Gorman_Flow_YearSummary, aes(x = year, y = meanDischarge, color = site_no)) +
  geom_point()+
  geom_smooth(method='lm')
print(MeanDischargeplot)

MeanMonthDischarge <- 
   ggplot(Club.Gorman_Flow_MonthSummary, aes(x = month, y = meanDischarge, color = site_no)) +
  geom_point()
print(MeanMonthDischarge)

MAxMonthDischarge <- 
   ggplot(Club.Gorman_Flow_MonthSummary, aes(x = month, y = maxDischarge, color = site_no)) +
  geom_point()
print(MAxMonthDischarge)


MaxYearDischarge <-
   ggplot(Club.Gorman_Flow_YearSummary, aes(x = year, y = maxDischarge, color = site_no)) +
  geom_point()
print(MaxYearDischarge)


DischargeTimeplot <-
  ggplot(Club.Gorman_Flow_Long, 
         aes(x = Date, y = Discharge, color = site_no))+
  geom_point() 
print(DischargeTimeplot)

DischargePlot <- 
  ggplot(Club.Gorman_Flow_Long, aes(x = Date, y = Discharge, color = site_no)) +
  geom_line() +
  ggtitle("Ellerbe Creek") +
  labs(x = "Time", y = expression("Discharge (ft"^3*"/s)")) + 
  theme(plot.title = element_text(margin = margin(b = -10), size = 12), 
        axis.text.x = element_blank(), axis.title.x = element_blank())
print(DischargePlot)

ClubDischargePlot <- 
  ggplot(Club.Gorman_Flow_Wide, aes(x = Date, y = Discharge.C)) +
  geom_line() +
  ggtitle("Club") +
  labs(x = "Time", y = expression("Discharge (ft"^3*"/s)")) + 
  theme(plot.title = element_text(margin = margin(b = -10), size = 12), 
        axis.text.x = element_blank(), axis.title.x = element_blank())
print(ClubDischargePlot)

ClubDischargePlot <- 
  ggplot(Club.Gorman_Flow_Wide, aes(x = Date, y = Discharge.G)) +
  geom_line() +
  ggtitle("Gorman") +
  labs(x = "Time", y = expression("Discharge (ft"^3*"/s)")) + 
  theme(plot.title = element_text(margin = margin(b = -10), size = 12), 
        axis.text.x = element_blank(), axis.title.x = element_blank())
print(ClubDischargePlot)

```



# Explore Nutrients with ggplot 
```{r}
### Phosphorus 

Pboxplot <-
  ggplot(EC_Flow.Nutrients_Wide, aes(x = HydrologicEvent, y = TP)) +
  geom_boxplot()
print(Pboxplot)


Discharge_TP <-
  ggplot(EC_Flow.Nutrients_Wide, 
         aes(x = TP, y = Discharge.C, color = HydrologicEvent))+
  xlim(0,400)+
  ylim(0,400)+
  geom_point() 
print(Discharge_TP)

# Log 

logDischarge_logTP <-
  ggplot(EC_Flow.Nutrients_Wide, 
         aes(x = log(TP), y = log(Discharge.C), color = HydrologicEvent))+
  geom_point()
print(logDischarge_logTP)
      

ClubGorman_Discharge_TP <-
  ggplot(Club.Gorman_Flow.Nutrients_Wide, 
         aes(x = TP, y = Discharge, color = HydrologicEvent))+
   xlim(0,400)+
  geom_point() 
print(ClubGorman_Discharge_TP)

Discharge_TN <-ggplot(EC_Flow.Nutrients_Wide, 
         aes(x = Inorganic_N, y =Discharge.G, color = HydrologicEvent))+
  geom_point()+
  geom_smooth()
print(Discharge_TN)

Discharge_TN <-ggplot(EC_Flow.Nutrients_Wide, 
         aes(x = Inorganic_N, y =Discharge.G))+
  geom_point()+
  geom_smooth()
print(Discharge_TN)

#Log Nitrogen

logDischarge_logTN <-ggplot(EC_Flow.Nutrients_Wide, 
         aes(x = log(Inorganic_N), y =log(Discharge.G)))+
  geom_point()+
  geom_smooth(method='lm')
print(logDischarge_logTN)


Discharge_Turbidity <-
  ggplot(EC_Flow.Nutrients_Wide, 
         aes(x = Turbidity, y = log(Discharge.G), color = HydrologicEvent))+
  geom_point()+
  geom_smooth(method = 'lm')
print(Discharge_Turbidity)

Discharge_XY <-
  ggplot(EC_Flow.Nutrients_Wide, 
         aes(x = X_00060_00003.x, y = X_00060_00003.y, color = HydrologicEvent))+
  geom_point() 
print(Discharge_XY)

TP_TN <- 
   ggplot(EC_Flow.Nutrients_Wide, 
         aes(x = Mixed_N, y = TP, color = site_no))+
  geom_point()
print(TP_TN)

```

#Discharge vs Gage
```{r}
DvsGHplot <-
  ggplot(Club.Gorman_Flow_Long, aes(x = Discharge, y = Gage.Height, color=site_no)) +
  scale_color_brewer(palette="YlGnBu")+
  geom_point(alpha = 0.75) 
print(DvsGHplot)
```

# Seasonal Trend 

```{r}
Ellerbe.Historical <- mutate(Club.Gorman_Flow_Long, 
                                         DOY = yday(Date))

EllerbeDischarge.Pattern <- Ellerbe.Historical %>%
  group_by(DOY) %>%
  summarise(Median.Discharge = median(Discharge), 
            Max.Discharge = max(Discharge),
            Min.Discharge = min(Discharge))

EllerbePatternPlot <- 
  ggplot(EllerbeDischarge.Pattern, aes(x = DOY)) +
  geom_line(aes(y = Median.Discharge)) +
  geom_line(aes(y = Max.Discharge), color = "gray") +
  geom_line(aes(y = Min.Discharge), color = "gray") +  
  labs(x = "Day of Year", y = expression("Discharge (ft"^3*"/s)")) 
print(EllerbePatternPlot)

### Just Gorman 
Gorman.Historical <- mutate(Club.Gorman_Flow_Wide, 
                                         DOY = yday(Date))

GormanDischarge.Pattern <- Gorman.Historical %>%
  group_by(DOY) %>%
  summarise(Median.Discharge = median(Discharge.G), 
            Max.Discharge = max(Discharge.G),
            Min.Discharge = min(Discharge.G))

GormanPatternPlot <- 
  ggplot(GormanDischarge.Pattern, aes(x = DOY)) +
  geom_line(aes(y = Median.Discharge)) +
  geom_line(aes(y = Max.Discharge), color = "gray") +
  geom_line(aes(y = Min.Discharge), color = "gray") +  
  labs(x = "Day of Year", y = expression("Discharge (ft"^3*"/s)")) 
print(GormanPatternPlot)

# Just Club 
Club.Historical <- mutate(Club.Gorman_Flow_Wide, 
                                         DOY = yday(Date))

class(Club.Historical$Discharge.C)
median(Club.Historical$Discharge.C, na.rm=TRUE)

ClubDischarge.Pattern <- Club.Historical %>%
  group_by(DOY) %>%
  summarise(Median.Discharge = median(Discharge.C,na.rm=TRUE), 
            Max.Discharge = max(Discharge.C, na.rm=TRUE),
            Min.Discharge = min(Discharge.C), na.rm=TRUE)

ClubPatternPlot <- 
  ggplot(ClubDischarge.Pattern, aes(x = DOY)) +
  geom_line(aes(y = Median.Discharge)) +
  geom_line(aes(y = Max.Discharge), color = "gray") +
  geom_line(aes(y = Min.Discharge), color = "gray") +  
  labs(x = "Day of Year", y = expression("Discharge (ft"^3*"/s)")) 
print(ClubPatternPlot)
```

# Nutrients near Club vs. Gorman
